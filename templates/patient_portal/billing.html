<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing & Payments | Panchkalpa</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- 1. GLOBAL THEME VARIABLES --- */
        :root {
            --theme-gold: #FFD700;
            --theme-gold-dark: #C8A300;
            --theme-cream: #FFF8E6;
            --theme-brown: #78350f;
            --theme-bg-light: #fff7e5;
            --theme-text-dark: #2A241F;
            --theme-muted: #6b5f5a;
            --theme-white: #ffffff;
            --theme-shadow: 0 4px 15px rgba(120, 53, 15, 0.08);
            --theme-radius: 12px;
            --theme-nav-height: 80px;
            
            /* Status Colors */
            --status-paid-bg: #E8F5E9; --status-paid-text: #2E7D32;
            --status-pending-bg: #FFF3E0; --status-pending-text: #EF6C00;
        }

        /* --- 2. BASE LAYOUT --- */
        body {
            margin: 0;
            font-family: 'Lato', sans-serif;
            background-color: var(--theme-bg-light);
            color: var(--theme-text-dark);
            padding-top: var(--theme-nav-height);
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            color: var(--theme-brown);
        }

        /* --- 3. NAVBAR (Consistent) --- */
        .dashboard-navbar-container {
            position: fixed; top: 0; left: 0; width: 100%;
            height: var(--theme-nav-height); background: var(--theme-brown);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        .dashboard-logo-wrapper img { height: 100px; margin-top: 10px; object-fit: contain; }
        
        .dashboard-nav-links-group { display: flex; gap: 10px; }
        .dashboard-nav-item-button {
            padding: 10px 18px; border-radius: 20px; font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.85); text-decoration: none;
            display: flex; align-items: center; gap: 8px; transition: 0.3s;
        }
        .dashboard-nav-item-button:hover { background: rgba(255, 255, 255, 0.1); color: var(--theme-gold); }
        .dashboard-nav-item-button.active { background: var(--theme-gold); color: var(--theme-brown); font-weight: 700; }
        .dashboard-nav-item-button.active i { color: var(--theme-brown); }
        .dashboard-nav-item-button i { color: var(--theme-gold); }

        .dashboard-nav-profile-section { display: flex; align-items: center; gap: 15px; }
        
        .dashboard-profile-summary-pill {
            display: flex; align-items: center; gap: 10px;
            background: rgba(0, 0, 0, 0.2); padding: 6px 15px 6px 6px;
            border-radius: 30px; border: 1px solid rgba(255, 215, 0, 0.2);
            cursor: pointer; transition: background 0.3s;
        }
        .dashboard-profile-summary-pill:hover { background: rgba(0, 0, 0, 0.4); border-color: var(--theme-gold); }
        
        .dashboard-profile-icon-circle {
            width: 32px; height: 32px; background: var(--theme-gold);
            color: var(--theme-brown); font-weight: 700; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Playfair Display', serif;
        }
        .dashboard-profile-name-text { font-size: 0.9rem; color: white; font-weight: 600; }
        .dashboard-logout-action { color: rgba(255, 255, 255, 0.6); background: none; border: none; font-size: 1.2rem; cursor: pointer; }
        .dashboard-logout-action:hover { color: #ff6b6b; }

        /* --- 4. BILLING CONTENT STYLES --- */
        .billing-main-container {
            padding: 40px; max-width: 1000px; margin: 0 auto;
        }

        .billing-page-header { margin-bottom: 30px; border-bottom: 1px solid rgba(120, 53, 15, 0.1); padding-bottom: 15px; }
        .billing-page-title { font-size: 2rem; }

        /* Generic Card */
        .billing-content-card {
            background: var(--theme-white); border-radius: var(--theme-radius);
            padding: 30px; box-shadow: var(--theme-shadow);
            border: 1px solid rgba(255, 215, 0, 0.2);
            margin-bottom: 30px;
        }
        .billing-card-header {
            font-family: 'Playfair Display', serif; font-size: 1.3rem;
            color: var(--theme-brown); margin-bottom: 20px;
            display: flex; align-items: center; gap: 10px;
            border-bottom: 1px dashed #eee; padding-bottom: 10px;
        }

        /* 1. PENDING BILLS LIST */
        .billing-pending-list { display: flex; flex-direction: column; gap: 15px; }
        
        .billing-pending-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; background: #fffbf0;
            border-left: 5px solid var(--theme-gold); border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03); transition: transform 0.2s;
        }
        .billing-pending-item:hover { transform: translateY(-2px); }

        .billing-info-group h4 { margin: 0; font-size: 1.1rem; color: var(--theme-text-dark); }
        .billing-info-group p { margin: 5px 0 0; font-size: 0.9rem; color: var(--theme-muted); }
        
        .billing-amount-box {
            text-align: right; display: flex; align-items: center; gap: 20px;
        }
        .billing-price { font-size: 1.4rem; font-weight: 700; color: var(--theme-brown); font-family: 'Playfair Display', serif; }
        
        .billing-pay-btn {
            background: var(--theme-brown); color: var(--theme-white);
            padding: 10px 25px; border-radius: 30px; border: none;
            font-weight: 700; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; gap: 8px;
        }
        .billing-pay-btn:hover { background: #5a270b; box-shadow: 0 4px 12px rgba(120, 53, 15, 0.3); }

        /* 2. HISTORY TABLE */
        .billing-table-wrapper { overflow-x: auto; }
        .billing-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        
        .billing-table th {
            text-align: left; padding: 15px; color: var(--theme-muted);
            border-bottom: 2px solid #eee; font-weight: 700; text-transform: uppercase; font-size: 0.85rem;
        }
        .billing-table td {
            padding: 15px; border-bottom: 1px solid #f5f5f5; color: var(--theme-text-dark);
        }
        
        .billing-status-badge {
            padding: 5px 12px; border-radius: 15px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
        }
        .status-paid { background: var(--status-paid-bg); color: var(--status-paid-text); }
        
        .billing-action-link {
            color: var(--theme-brown); text-decoration: none; font-weight: 700; font-size: 0.85rem;
            border: 1px solid var(--theme-brown); padding: 5px 10px; border-radius: 6px;
            transition: 0.2s;
        }
        .billing-action-link:hover { background: var(--theme-brown); color: var(--theme-white); }

        /* Empty State */
        .billing-empty-state { text-align: center; padding: 30px; color: var(--theme-muted); font-style: italic; }

        @media (max-width: 768px) {
            .billing-pending-item { flex-direction: column; align-items: flex-start; gap: 15px; }
            .billing-amount-box { width: 100%; justify-content: space-between; }
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="dashboard-navbar-container">
        <div class="dashboard-logo-wrapper">
            <img src="/static/assets/panchkalpa-logo-trans.png" alt="Panchkalpa">
        </div>
        <div class="dashboard-nav-links-group">
            <a href="dashboard.html" class="dashboard-nav-item-button"><i class="fa-brands fa-dashcube"></i> Dashboard</a>
            <a href="appointments.html" class="dashboard-nav-item-button"><i class="fa-solid fa-video"></i> Appointments</a>
            <a href="progress.html" class="dashboard-nav-item-button"><i class="fa-regular fa-calendar-check"></i> Progress</a>
            <a href="billing.html" class="dashboard-nav-item-button active"><i class="fa-solid fa-file-invoice"></i> Billing</a>
        </div>
        <div class="dashboard-nav-profile-section">
            <div class="dashboard-profile-summary-pill" onclick="window.location.href='profile.html'">
                <div class="dashboard-profile-icon-circle" id="header-initial">?</div>
                <div class="dashboard-profile-name-text" id="header-name">Loading...</div>
            </div>
            <button class="dashboard-logout-action" title="Logout"><i class="fa-solid fa-right-from-bracket"></i></button>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="billing-main-container">
        
        <div class="billing-page-header">
            <h1 class="billing-page-title">Billing & Payments</h1>
        </div>

        <!-- 1. PENDING BILLS -->
        <div class="billing-content-card">
            <div class="billing-card-header">
                <i class="fas fa-file-invoice-dollar" style="color:var(--theme-gold-dark)"></i> Pending Bills
            </div>
            
            <div class="billing-pending-list" id="pending-bills-container">
                <!-- JS Injected -->
                <div class="billing-empty-state">Checking for pending bills...</div>
            </div>
        </div>

        <!-- 2. PAYMENT HISTORY -->
        <div class="billing-content-card">
            <div class="billing-card-header">
                <i class="fas fa-history" style="color:var(--theme-gold-dark)"></i> Payment History
            </div>
            
            <div class="billing-table-wrapper">
                <table class="billing-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Invoice ID</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="history-bills-container">
                        <!-- JS Injected -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchBillingData();
            
            // Header User Logic (Mock)
            const user = { name: "Aniket" };
            document.getElementById('header-name').textContent = user.name;
            document.getElementById('header-initial').textContent = user.name.charAt(0);
        });

        async function fetchBillingData() {
            // Default Mock Data
            let data = {
                pending: [
                    { id: "INV-1234", description: "Shirodhara Session (Nov 22)", amount: 500 },
                    { id: "INV-2234", description: "Virechana Medicine Kit", amount: 750 }
                ],
                history: [
                    { date: "Nov 15, 2025", id: "INV-1221", description: "Consultation Fee", amount: 300, status: "Paid" },
                    { date: "Nov 10, 2025", id: "INV-1109", description: "Abhyanga Therapy", amount: 1200, status: "Paid" }
                ]
            };

            try {
                // Try Backend
                const response = await fetch('/api/patient/billing/', { method: 'GET' });
                if (response.ok) {
                    const backendData = await response.json();
                    data = backendData;
                }
            } catch (error) {
                console.warn("Backend offline, using mock billing data.");
            }

            renderBilling(data);
        }

        function renderBilling(data) {
            // Render Pending
            const pendingContainer = document.getElementById('pending-bills-container');
            pendingContainer.innerHTML = '';

            if (data.pending.length === 0) {
                pendingContainer.innerHTML = '<div class="billing-empty-state">You have no pending bills. Great!</div>';
            } else {
                data.pending.forEach(bill => {
                    const html = `
                    <div class="billing-pending-item">
                        <div class="billing-info-group">
                            <h4>Bill #${bill.id}</h4>
                            <p>${bill.description}</p>
                        </div>
                        <div class="billing-amount-box">
                            <span class="billing-price">₹${bill.amount}</span>
                            <button class="billing-pay-btn" onclick="payBill('${bill.id}')">
                                Pay Now <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>`;
                    pendingContainer.innerHTML += html;
                });
            }

            // Render History
            const historyContainer = document.getElementById('history-bills-container');
            historyContainer.innerHTML = '';

            if (data.history.length === 0) {
                historyContainer.innerHTML = '<tr><td colspan="6" class="billing-empty-state">No payment history found.</td></tr>';
            } else {
                data.history.forEach(bill => {
                    const html = `
                    <tr>
                        <td>${bill.date}</td>
                        <td><strong>#${bill.id}</strong></td>
                        <td>${bill.description}</td>
                        <td>₹${bill.amount}</td>
                        <td><span class="billing-status-badge status-paid">${bill.status}</span></td>
                        <td><a href="#" class="billing-action-link" onclick="viewReceipt('${bill.id}')">View Receipt</a></td>
                    </tr>`;
                    historyContainer.innerHTML += html;
                });
            }
        }

        function payBill(id) {
            // Integrate Payment Gateway Logic Here (Razorpay/Stripe)
            alert(`Initiating payment for Bill ${id}...`);
        }

        function viewReceipt(id) {
            alert(`Opening receipt for Bill ${id}...`);
        }
    </script>

</body>
</html>